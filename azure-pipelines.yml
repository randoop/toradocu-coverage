jobs:
- job: everything
  pool:
    vmImage: 'ubuntu-16.04'
  container: mdernst/randoop-ubuntu-jdkany-coverage:latest
  steps:
  - checkout: self
    fetchDepth: 25
    # To test locally, do (for example):
    #   git clone https://github.com/randoop/toradocu-coverage.git --branch dockerfile
    #   cd toradocu-coverage
  - bash: mkdir -p evaluation/coverage && mkdir -p evaluation/logs && mkdir -p toradocu/logs && (cd extractcoverage && ./gradlew assemble)
    displayName: create-directory-structure.sh
  - bash: ./fetch_and_compile_corpus
    displayName: fetch_and_compile_corpus
# TODO: use a different version of Randoop
  - bash: ./run_randoop_on_corpus
    displayName: run_randoop_on_corpus
  - bash: ./coverage.sh
    displayName: coverage.sh
  - bash: ./show-coverage.pl
    displayName: show-coverage.pl


